<!DOCTYPE html>
<html>
<head>
<title>Hello, Canvas World!</title>
<!--[if IE]><script src="excanvas.js"></script><![endif]-->
<script type="text/javascript">
var fov = 250;
var SCREEN_WIDTH = 640; 
var SCREEN_HEIGHT = 480; 
var HALF_WIDTH = SCREEN_WIDTH/2; 
var HALF_HEIGHT = SCREEN_HEIGHT/2; 
var numPoints = 200; 
var mouseX = 0; 
var mouseY = -200; 
var points = [];
var canvas;
var ctx;

function draw()
{
    canvas = document.getElementById("canvas2d");
    ctx = canvas.getContext("2d");
    document.onmousemove = updateMouse;
    initPoints();
    setInterval(render, 50);
}

function initPoints()
{
    var point;
    var i;
    for (i = 0; i < numPoints; i++)
    {
        point = { x:(Math.random()*400)-200, y:(Math.random()*400)-200 , z:(Math.random()*400)-200 };
        points.push(point); 
    }
}

function render() 
{
    clear();
    
    var point;
    var i;
    for (i = 0; i < numPoints; i++)
    {
        point = points[i]; 
        rotateY(point, mouseX * -0.0003); 
        point.z += (mouseY * 0.08);     
        
        if (point.x < -300)
        {
            point.x = 300; 
        }
        else if (point.x > 300)
        {
            point.x = -300; 
        }
        
        if (point.z < -fov)
        {
            point.z = fov; 
        }
        else if (point.z > fov)
        {
            point.z = -fov;
        }
        
        draw3D(point); 
    }
}

function draw3D(point)
{  
    var x3d = point.x;
    var y3d = point.y; 
    var z3d = point.z; 
    var scale = fov / (fov + z3d); 
    var x2d = (x3d * scale) + HALF_WIDTH;
    var y2d = (y3d * scale) + HALF_HEIGHT;
    
    ctx.lineWidth = scale; 
    ctx.strokeStyle = "rgb(255, 255, 255)";
    ctx.beginPath();
    ctx.moveTo(x2d, y2d); 
    ctx.lineTo(x2d + scale, y2d); 
    ctx.stroke(); 
}


function rotateY(point, angle)
{
    var x = point.x; 
    var z = point.z + fov; 
    
    var cosRY = Math.cos(angle);
    var sinRY = Math.sin(angle);
    var tempz = z; 
    var tempx = x; 

    x = (tempx * cosRY) + (tempz * sinRY);
    z = (tempx * -sinRY) + (tempz * cosRY);
    point.x = x; 
    point.z = z - fov; 
}

function clear()
{
    ctx.fillStyle = "rgb(0, 0, 0)";
    ctx.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);
}

function updateMouse(e) 
{
    mouseX = e.pageX - canvas.offsetLeft - HALF_WIDTH; 
    mouseY = e.pageY - canvas.offsetTop - HALF_HEIGHT;
}
</script>
</head>
<body onload="draw()">
<canvas id="canvas2d" width="640" height="480"></canvas>
<a href="https://github.com/cx20/hello/blob/master/html5/canvas/3-4.space4.html" target="_blank">View Source</a>
</body>
</html>
